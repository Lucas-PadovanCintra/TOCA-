<div class="container mt-5">
  <div class="row">
    <!-- Back Button -->
    <div class="col-12 mb-3">
      <%= link_to instruments_path, class: "btn btn-outline-secondary" do %>
        <i class="fas fa-arrow-left"></i> Voltar aos Instrumentos
      <% end %>
    </div>

    <!-- Instrument Details Card -->
    <div class="col-lg-8 offset-lg-2">
      <div class="card shadow-lg border-0">
        <!-- Card Header -->
        <div class="card-header bg-gradient-primary text-white py-4">
          <div class="row align-items-center">
            <div class="col">
              <h1 class="card-title mb-0 h2">
                <i class="fas fa-guitar me-3"></i><%= @instrument.name %>
              </h1>
            </div>
            <div class="col-auto">
              <span class="badge bg-light text-primary fs-6 px-3 py-2">
                <%= @instrument.category %>
              </span>
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body p-4">
          <div class="row">
            <!-- Left Column - Main Info -->
            <div class="col-md-8">
              <!-- Brand -->
              <div class="mb-4">
                <h5 class="text-primary mb-2">
                  <i class="fas fa-trademark"></i> Marca
                </h5>
                <p class="fs-5 text-muted mb-0"><%= @instrument.brand %></p>
              </div>

              <!-- Description -->
              <div class="mb-4">
                <h5 class="text-primary mb-2">
                  <i class="fas fa-info-circle"></i> Descrição
                </h5>
                <p class="text-muted lh-lg">
                  <%= simple_format(@instrument.description) if @instrument.respond_to?(:description) %>
                </p>
              </div>

              <!-- Owner Info -->
              <div class="mb-4">
                <h5 class="text-primary mb-2">
                  <i class="fas fa-user"></i> Proprietário
                </h5>
                <p class="text-muted">
                  <% if @instrument.user %>
                    <i class="fas fa-envelope me-2"></i><%= @instrument.user.email %>
                  <% else %>
                    <span class="text-muted">Não informado</span>
                  <% end %>
                </p>
              </div>
            </div>

            <!-- Right Column - Price and Actions -->
            <div class="col-md-4">
              <!-- Price Card -->
              <div class="card bg-success text-white mb-4">
                <div class="card-body text-center py-4">
                  <h6 class="card-title mb-2 opacity-75">PREÇO</h6>
                  <h2 class="card-text mb-0 fw-bold">
                    <i class="fas fa-tag me-2"></i><%= @instrument.formatted_price %>
                  </h2>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-2">
                <% if @instrument.user %>
                  <%= link_to edit_user_instrument_path(@instrument.user, @instrument), 
                      class: "btn btn-primary btn-lg" do %>
                    <i class="fas fa-edit"></i> Editar Instrumento
                  <% end %>
                  
                  <%= link_to user_instrument_path(@instrument.user, @instrument), 
                      method: :delete,
                      data: { confirm: "Tem certeza que deseja excluir este instrumento?" },
                      class: "btn btn-outline-danger" do %>
                    <i class="fas fa-trash"></i> Excluir Instrumento
                  <% end %>
                <% end %>

                <%= form_with url: orders_path do %>
                  <%= hidden_field_tag 'instrument_id', @instrument.id %>
                  <%= submit_tag 'Purchase', class: 'btn btn-primary' %>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer bg-light py-3">
          <div class="row align-items-center">
            <div class="col">
              <small class="text-muted">
                <i class="fas fa-calendar-plus me-2"></i>
                Cadastrado em <%= @instrument.created_at.strftime("%d/%m/%Y às %H:%M") %>
              </small>
            </div>
            <div class="col-auto">
              <% if @instrument.created_at != @instrument.updated_at %>
                <small class="text-muted">
                  <i class="fas fa-calendar-edit me-2"></i>
                  Última atualização: <%= @instrument.updated_at.strftime("%d/%m/%Y às %H:%M") %>
                </small>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Similar Instruments Section -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="text-center mb-4 text-primary">
        <i class="fas fa-search"></i> Outros Instrumentos da Mesma Categoria
      </h3>
      
      <div class="row">
        <% similar_instruments = Instrument.where(category: @instrument.category).where.not(id: @instrument.id).limit(3) %>
        <% if similar_instruments.any? %>
          <% similar_instruments.each do |instrument| %>
            <div class="col-md-4 mb-4">
              <div class="card h-100 border-0 shadow-sm">
                <div class="card-body">
                  <h6 class="card-title text-primary">
                    <i class="fas fa-guitar me-2"></i><%= instrument.name %>
                  </h6>
                  <p class="card-text text-muted small mb-2">
                    <strong>Marca:</strong> <%= instrument.brand %>
                  </p>
                  <p class="card-text text-success fw-bold">
                    <i class="fas fa-tag me-1"></i><%= instrument.formatted_price %>
                  </p>
                </div>
                <div class="card-footer bg-transparent border-0">
                  <%= link_to "Ver Detalhes", instrument_path(instrument), 
                      class: "btn btn-outline-primary btn-sm" %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="col-12 text-center">
            <p class="text-muted">
              <i class="fas fa-info-circle me-2"></i>
              Nenhum outro instrumento encontrado nesta categoria.
            </p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<style>
  .bg-gradient-primary {
    background: linear-gradient(135deg, #007bff, #0056b3) !important;
  }
  
  .card {
    border-radius: 15px;
    overflow: hidden;
  }
  
  .card-header {
    border-bottom: none;
  }
  
  .btn {
    border-radius: 10px;
  }
  
  .badge {
    border-radius: 10px;
  }
</style>
